---
# tasks file to download and setup firefox dev
- name: set tarball name
  set_fact:
    tarball_name: firefox-dev.tar.bz2

- name: set destination directory
  set_fact:
    dest_dir: /opt/firefox-dev/

- name: set source url
  set_fact:
    source_url: "https://download.mozilla.org/?product=firefox-devedition-latest-ssl&os=linux64&lang=en-US"

- name: Download firefox dev to /tmp
  ansible.builtin.get_url:
    url: "{{ source_url }}"
    dest: "/tmp/{{ tarball_name }}"

- name: untar firefox dev
  ansible.builtin.unarchive:
    src: "/tmp/{{ tarball_name }}"
    dest: /tmp/

- name: Move firefox folder to /opt/firefox-dev/
  become: true
  ansible.builtin.copy: 
    src: /tmp/firefox/ 
    dest: "{{ dest_dir }}"

- name: remove firefox tarball
  ansible.builtin.file: 
    path: "/tmp/{{ tarball_name }}"
    state: absent
  changed_when: false

- name: remove unarchive folder
  ansible.builtin.file: 
    path: /tmp/firefox/
    state: absent
  changed_when: false

- name: create symlink to /usr/local/bin
  become: yes
  ansible.builtin.file: 
    src: "{{ dest_dir }}/firefox"
    dest: /usr/local/bin/firefox-dev
    owner: root
    group: root
    state: link

- name: create .desktop entry
  ansible.builtin.copy:
    src: files/firefox-dev.desktop
    dest: $HOME/.local/share/applications/firefox-dev.desktop

